{% extends "flask_user_layout.html" %}

{% block extra_js %}
<script src="{{ url_for('static', filename='ratings.js') }}"></script>
{% endblock %}

{% block extra_css %}
<style>
    .checked {
        color: orange; 
    }
    .checked_average {
        color: orange; 
        border-bottom: 2px solid gold;
    }
    .average {  
        border-bottom: 2px solid gold;
    }
    .fa-star:focus {
        outline: none;        /* Removes the default focus properties*/
        color: orange;          
        background: none;     
        text-shadow: none;    
    }
</style>

{% endblock %}

{% block content %}
<div class="container">
    <h2>Movies</h2>

    {% for m in movies %}
        <div class="panel panel-default">
            <div class="panel-heading"><b>{{ m.title }}</b></div>
            <div class="panel-body">
                <!-- Display genres -->
                <p>
                    {% for g in m.genres %}
                        <span class="label label-default">{{ g.genre }}</span>
                    {% endfor %}
                </p>
                <!-- Display IMDb and TMDb links if available -->
                {% if movie_links.get(m.id) %}
                    <p>IMDb: <a href="https://www.imdb.com/title/tt{{ movie_links[m.id].imdb_id }}" target="_blank">{{ movie_links[m.id].imdb_id }}</a></p>
                    <p>TMDb: <a href="https://www.themoviedb.org/movie/{{ movie_links[m.id].tmdb_id }}" target="_blank">{{ movie_links[m.id].tmdb_id }}</a></p>
                {% endif %}
                <!-- Display tags -->
                {% if movie_tags.get(m.id) %}
                    <p>Tags:
                        {% for tag in movie_tags[m.id] %}
                            <span>{{ tag.tag_content }}</span>{% if not loop.last %}, {% endif %}
                        {% endfor %}
                    </p>
                {% endif %}

                <!-- Display stars based on average rating -->
                <div class="panel-footer">Rate:
                    {% for i in range(1, 6) %}
                        <a href="#" onclick="event.preventDefault(); addRating({{ current_user.id }}, {{ m.id }}, {{ i }}, this.id);" id='{{ m.id }}_{{ i }}'>
                            <span class="fa fa-star 
                                {% if user_rating.get(m.id) and user_rating[m.id][0].rating >= i and average_rating[m.id] == i %}
                                    checked_average
                                {% elif user_rating.get(m.id) and user_rating[m.id][0].rating >= i %}
                                    checked
                                {% elif average_rating[m.id] == i %}
                                    average
                                {% endif %}">
                            </span> 
                        </a>
                    {% endfor %}
                    Stars
                </div>    
            </div>
        </div>
    {% endfor %}
</div>

{% endblock %}